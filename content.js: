chrome.runtime.onMessage.addListener(function(request, sender, sendResponse) {
  if (request.action === "showNotePopup") {
    const popup = document.createElement("div");
    popup.style.position = "absolute";
    popup.style.left = request.x + "px";
    popup.style.top = request.y + "px";
    popup.innerHTML = `
      <textarea></textarea>
      <button id="saveNote">Save</button>
    `;
    document.body.appendChild(popup);

    const saveButton = popup.querySelector("#saveNote");
    saveButton.addEventListener("click", function() {
      const note = popup.querySelector("textarea").value;
      chrome.runtime.sendMessage({ action: "saveNote", note: note });
      popup.remove();
    });
  }
});

chrome.runtime.sendMessage({ action: "contentScriptLoaded" });
